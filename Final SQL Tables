SELECT *  FROM sopra.pred;

SELECT * FROM sopra.preprocessing_post_OHE2 ;

SELECT sopra.preprocessing_post_OHE2.*, sopra.pred.Round,sopra.pred.imputated
FROM sopra.preprocessing_post_OHE2 LEFT JOIN sopra.pred ON sopra.pred.rank = sopra.preprocessing_post_OHE2.rank;

DROP TABLE IF EXISTS sopra.final;

CREATE TABLE IF NOT EXISTS sopra.final
	AS (SELECT sopra.preprocessing_post_OHE2.*, sopra.pred.Round,sopra.pred.imputated
   FROM sopra.preprocessing_post_OHE2 LEFT JOIN sopra.pred ON sopra.pred.rank = sopra.preprocessing_post_OHE2.rank);

	 SELECT * FROM sopra.final;

	 UPDATE sopra.final
	 SET Ozone = CASE WHEN final.imputated IS NULL THEN Ozone
	 ELSE round END ;

	 SELECT * FROM sopra.final;

	 DROP TABLE IF EXISTS sopra.export;

	 Create TABLE IF NOT EXISTS sopra.export as (SELECT REVERSE_NORMALIZE (Sensor_id, timestamp, imputated, Ozone USING PARAMETERS  model_name = 'Normalisation_Fit') FROM sopra.final);

	 SELECT * FROM sopra.export;
